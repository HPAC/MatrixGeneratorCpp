language: cpp
dist: trusty
compiler:
  - gcc
  - clang
addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
      - llvm-toolchain-trusty-4.0
    packages:
      - g++-6
      - clang-4.0
      - libgtest-dev
      - libboost-all-dev
cache:
  apt: true

install:
  - if [ "$CXX" = "g++" ]; then export CXX="g++-6"; fi
  - if [ "$CXX" = "clang++" ]; then export CXX="clang++-4.0"; fi
# CMake 3.5 is required by Blaze; Trusty PPA's have 3.2.x
  - wget --no-check-certificate https://cmake.org/files/v3.5/cmake-3.5.2-Linux-x86_64.sh
  - chmod a+x cmake-3.5.2-Linux-x86_64.sh
  - sudo ./cmake-3.5.2-Linux-x86_64.sh --skip-license --prefix=/usr/local
  - pushd .
  - mkdir -p deps
  - cd deps
  - if [ ! -d "blaze" ]; then export BUILD_BLAZE="yes"; else export BUILD_BLAZE="no"; fi
  - if [ "$BUILD_BLAZE" == "yes" ]; then mkdir blaze && cd blaze && git clone https://bitbucket.org/blaze-lib/blaze.git && mkdir build && mkdir install; fi
  - if [ "$BUILD_BLAZE" == "yes" ]; then cd build && cmake -DCMAKE_INSTALL_PREFIX=$(pwd)/../install ../blaze && make install && cd ../install; fi
  - if [ "$BUILD_BLAZE" == "no" ]; then cd blaze/install ; fi
  - export BLAZE_ROOT="$(pwd)"
  - popd

script:
  - mkdir build && cd build
  - cmake -DWITH_BLAZE=On -DWITH_EXAMPLES=On ..
  - cmake --build 
